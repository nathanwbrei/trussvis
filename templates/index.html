<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

    <!-- Basic Page Needs
  ================================================== -->
    <meta charset="utf-8">
    <title>TrussViz with D3</title>
    <meta name="description" content="">
    <meta name="author" content="Nathan Brei">

    <!-- Mobile Specific Metas
  ================================================== -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- CSS
  ================================================== -->
    <link rel="stylesheet" href="static/stylesheets/base.css">
    <link rel="stylesheet" href="static/stylesheets/skeleton.css">
    <link rel="stylesheet" href="static/stylesheets/layout.css">

    <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Favicons
    ================================================== -->
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">

    <script type="text/javascript" src="static/d3/d3.v3.js"></script>
    <script type="text/javascript" src="static/jquery/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="static/jquery/jquery.console.js"></script>

    <script type="text/javascript">
        $(document).ready(function(){
            var console2 = $('<div class="console2">');
            $('.feed').append(console2);
            controller2 = console2.console({
                promptLabel: '> ',
                commandValidate:function(line){
                    if (line == "") return false;
                    else return true;
                },
                commandHandle:function(line){
                    // var self = this;
                    $.ajax( {url: "trussvis", 
                            type:"POST", 
                            contentType:"text/plain",
                            dataType:"json",
                            data: JSON.stringify({'line':line}),
                            success: function(data){
                                console.log("Updating SVG");
                                controller2.commandResult("==> "+data['msg']);
                                update_svg(data['vis']['edges'], data['vis']['nodes']);
                                },
                            error:function(a,b,c){console.log("FAILED"+c)}});


                    // try { var ret = eval(line);
                    //     if (typeof ret != 'undefined') return ret.toString();
                    //     else return true; }
                    // catch (e) { return e.toString(); }
                },
                animateScroll:true,
                promptHistory:true,
                welcomeMessage:'Welcome to TrussViz.'
            });
            controller2.promptText('load test.json');
        });
    </script>


    <style type="text/css" media="screen">
          div.console2 { font-size: 14px; word-wrap:break-word; }
          div.console2
           { height:400px; overflow:auto }
          div.jquery-console-inner
           { padding:0.5em;}
          div.console2 div.jquery-console-prompt-box
           { color:#444; font-family:monospace; }
          div.console2 div.jquery-console-focus span.jquery-console-cursor
           { background:#333; color:#eee; font-weight:bold }
          div.console2 div.jquery-console-message-error
           { color:#ef0505; font-family:sans-serif; font-weight:bold;
             padding:0.1em; }
          div.console2 div.jquery-console-message-success
           { color:#187718; font-family:monospace;
             padding:0.1em; }
          div.console2 span.jquery-console-prompt-label { font-weight:bold }
    </style>

</head>
<body>



    <!-- Primary Page Layout
    ================================================== -->

    <!-- Delete everything in this .container and get started on your own site! -->


    <div class="container">
        <div class="sixteen columns">
            <h1 class="remove-bottom" style="margin-top: 40px">TrussViz</h1>
            <h6>by Nathan Brei for Fun via HackerSchool</h6>
            <hr />
        </div>
        <div class="two-thirds column">
            <div id="viz">
                <svg width="100%" height="400">
                    <rect x="0" y="0" width="600" height="400"/>
                </svg>
            </div>
        </div>
        <div class="one-third column feed"></div>


        <script type="text/javascript">

            update_svg = function(members, interfaces){

                svg = d3.select("svg");
                svg.selectAll("line").remove()
                svg.selectAll("circle").remove()

                svg.selectAll("line")
                    .data(members)
                    .enter()
                    .append("line")
                    .attr("stroke-width", 5)
                    .attr("stroke", function(d,i) {
                        color = d["color"]
                        if (color){
                            return color;
                        }
                        else
                            return "white";
                    })
                    .attr("x1", function(d, i) {
                        return interfaces[d["i0"]]["x"]*20 + 150;
                        })
                    .attr("y1", function(d, i) {
                        return interfaces[d["i0"]]["y"]*-20 + 150;
                        })
                    .attr("x2", function(d, i) {
                        return interfaces[d["i1"]]["x"]*20 + 150;
                        })
                    .attr("y2", function(d, i) {
                        return interfaces[d["i1"]]["y"]*-20 + 150;
                        });

                svg.selectAll("circle")
                    .data(interfaces)
                    .enter()
                    .append("circle")
                    .attr("r", 5)
                    .attr("fill", "white")
                    .attr("cx", function(d, i) {
                        return d["x"]*20 + 150;
                        })
                    .attr("cy", function(d, i) {
                        return d["y"]*-20 + 150;
                        });

                }
            
            // Your beautiful D3 code will go here
        </script>

    </div><!-- container -->



<!-- End Document
================================================== -->
</body>
</html>